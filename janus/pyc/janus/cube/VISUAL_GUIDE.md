# Cube Matrix Accelerator - Visual Guide

> A visual journey through the 16x16 systolic array matrix multiplication accelerator

---

## Quick Overview

```
    What is Cube?
    ═════════════

    ┌─────────────────────────────────────────────────────────────┐
    │                                                             │
    │   Input A          Cube Accelerator           Output C      │
    │   (Vector)         (16x16 Array)              (Matrix)      │
    │                                                             │
    │   ┌───┐           ┌─────────────┐            ┌─────────┐   │
    │   │ a │           │ ■ ■ ■ ■ ■ ■ │            │ c c c c │   │
    │   │ a │    ───►   │ ■ ■ ■ ■ ■ ■ │    ───►   │ c c c c │   │
    │   │ a │           │ ■ ■ ■ ■ ■ ■ │            │ c c c c │   │
    │   │ a │           │ ■ ■ ■ ■ ■ ■ │            │ c c c c │   │
    │   └───┘           └─────────────┘            └─────────┘   │
    │                                                             │
    │   16 activations   256 PEs with              256 results   │
    │   (16-bit each)    pre-loaded weights        (32-bit each) │
    │                                                             │
    └─────────────────────────────────────────────────────────────┘

    Formula: C = W × A  (Matrix-Vector Multiplication)
```

---

## 1. The Big Picture

### 1.1 Cube in the System

```
    ╔═══════════════════════════════════════════════════════════════════╗
    ║                         HOST SYSTEM                               ║
    ╠═══════════════════════════════════════════════════════════════════╣
    ║                                                                   ║
    ║   ┌─────────┐         Memory Bus          ┌─────────────────┐   ║
    ║   │         │◄───────────────────────────►│                 │   ║
    ║   │   CPU   │                             │   CUBE          │   ║
    ║   │         │         Control             │   ACCELERATOR   │   ║
    ║   │         │────────────────────────────►│                 │   ║
    ║   └─────────┘                             │   ┌───────────┐ │   ║
    ║       │                                   │   │ 16x16     │ │   ║
    ║       │                                   │   │ Systolic  │ │   ║
    ║       ▼                                   │   │ Array     │ │   ║
    ║   ┌─────────┐                             │   └───────────┘ │   ║
    ║   │  Main   │                             │                 │   ║
    ║   │ Memory  │                             └─────────────────┘   ║
    ║   └─────────┘                                                   ║
    ║                                                                   ║
    ╚═══════════════════════════════════════════════════════════════════╝
```

### 1.2 What Cube Does

```
    ┌─────────────────────────────────────────────────────────────────┐
    │                    MATRIX MULTIPLICATION                        │
    ├─────────────────────────────────────────────────────────────────┤
    │                                                                 │
    │     Weight Matrix W          Activation A        Result C      │
    │     (16 x 16)                (16 x 1)            (16 x 16)     │
    │                                                                 │
    │   ┌─────────────────┐       ┌───┐             ┌─────────────┐  │
    │   │ w00 w01 ... w0F │       │a0 │             │ c00 ... c0F │  │
    │   │ w10 w11 ... w1F │       │a1 │             │ c10 ... c1F │  │
    │   │  .   .       .  │   ×   │ . │      =      │  .       .  │  │
    │   │  .   .       .  │       │ . │             │  .       .  │  │
    │   │ wF0 wF1 ... wFF │       │aF │             │ cF0 ... cFF │  │
    │   └─────────────────┘       └───┘             └─────────────┘  │
    │                                                                 │
    │   Each c[i][j] = w[i][j] × a[j]  (accumulated over cycles)     │
    │                                                                 │
    └─────────────────────────────────────────────────────────────────┘
```

---

## 2. Inside the Cube: Systolic Array

### 2.1 Array Structure (Bird's Eye View)

```
                        Activations flow DOWN (↓)
                        ════════════════════════

              a[0]    a[1]    a[2]         a[15]
               ↓       ↓       ↓     ...     ↓
            ┌──────┬──────┬──────┬───────┬──────┐
    w[0]──► │ PE   │ PE   │ PE   │  ...  │ PE   │──► partial_sum
            │(0,0) │(0,1) │(0,2) │       │(0,15)│
            ├──────┼──────┼──────┼───────┼──────┤
    w[1]──► │ PE   │ PE   │ PE   │  ...  │ PE   │──► partial_sum
            │(1,0) │(1,1) │(1,2) │       │(1,15)│
            ├──────┼──────┼──────┼───────┼──────┤
    w[2]──► │ PE   │ PE   │ PE   │  ...  │ PE   │──► partial_sum
            │(2,0) │(2,1) │(2,2) │       │(2,15)│
            ├──────┼──────┼──────┼───────┼──────┤
       .    │  .   │  .   │  .   │   .   │  .   │
       .    │  .   │  .   │  .   │   .   │  .   │
            ├──────┼──────┼──────┼───────┼──────┤
    w[15]─► │ PE   │ PE   │ PE   │  ...  │ PE   │──► partial_sum
            │(15,0)│(15,1)│(15,2)│       │(15,15)│
            └──────┴──────┴──────┴───────┴──────┘
               ↓       ↓       ↓     ...     ↓
            ═══════════════════════════════════
            Results accumulate at BOTTOM (C matrix)
```

### 2.2 Data Flow Animation

```
    ╔═══════════════════════════════════════════════════════════════╗
    ║                    CYCLE-BY-CYCLE ANIMATION                   ║
    ╠═══════════════════════════════════════════════════════════════╣

    CYCLE 0: Load Weights (weights stay stationary)
    ─────────────────────────────────────────────────

         w00 ──► ┌────┐    w01 ──► ┌────┐    w02 ──► ┌────┐
                 │ PE │            │ PE │            │ PE │
                 │ w  │            │ w  │            │ w  │
                 └────┘            └────┘            └────┘

    CYCLE 1: First activation row streams in
    ─────────────────────────────────────────────────

                  a0              a1              a2
                  ↓               ↓               ↓
                 ┌────┐          ┌────┐          ┌────┐
         0 ───► │w×a │ ────────►│w×a │ ────────►│w×a │ ───► sum
                 │+acc│          │+acc│          │+acc│
                 └────┘          └────┘          └────┘
                  ↓               ↓               ↓
                 acc             acc             acc

    CYCLE 2-16: Continue streaming activations
    ─────────────────────────────────────────────────

                  a0              a1              a2
                  ↓               ↓               ↓
                 ┌────┐          ┌────┐          ┌────┐
        sum ──► │w×a │ ────────►│w×a │ ────────►│w×a │ ───► sum
                 │+acc│          │+acc│          │+acc│
                 └────┘          └────┘          └────┘
                  ↓               ↓               ↓
                 acc             acc             acc

    CYCLE 17-31: Drain phase (flush pipeline)
    ─────────────────────────────────────────────────

                  0               0               0
                  ↓               ↓               ↓
                 ┌────┐          ┌────┐          ┌────┐
        sum ──► │ 0  │ ────────►│ 0  │ ────────►│ 0  │ ───► sum
                 │+acc│          │+acc│          │+acc│
                 └────┘          └────┘          └────┘
                  ↓               ↓               ↓
               RESULT          RESULT          RESULT

    ╚═══════════════════════════════════════════════════════════════╝
```

---

## 3. Processing Element (PE) - The Heart of Cube

### 3.1 PE Block Diagram

```
    ╔═══════════════════════════════════════════════════════════════╗
    ║                    PROCESSING ELEMENT (PE)                    ║
    ╠═══════════════════════════════════════════════════════════════╣
    ║                                                               ║
    ║                    activation_in (16-bit)                     ║
    ║                           │                                   ║
    ║                           ▼                                   ║
    ║    partial_sum_in    ┌─────────┐                             ║
    ║    (32-bit)          │         │                             ║
    ║         │            │   ×     │◄──── weight_reg (16-bit)    ║
    ║         │            │         │      [loaded once]          ║
    ║         │            └────┬────┘                             ║
    ║         │                 │                                   ║
    ║         │            product (32-bit)                        ║
    ║         │                 │                                   ║
    ║         │                 ▼                                   ║
    ║         │            ┌─────────┐                             ║
    ║         └───────────►│    +    │                             ║
    ║                      └────┬────┘                             ║
    ║                           │                                   ║
    ║                           ▼                                   ║
    ║                    ┌───────────┐                             ║
    ║                    │    acc    │ accumulator (32-bit)        ║
    ║                    │  register │                             ║
    ║                    └─────┬─────┘                             ║
    ║                          │                                    ║
    ║              ┌───────────┴───────────┐                       ║
    ║              ▼                       ▼                        ║
    ║       activation_out          partial_sum_out                ║
    ║       (to PE below)           (to PE right)                  ║
    ║                                                               ║
    ╚═══════════════════════════════════════════════════════════════╝
```

### 3.2 PE Operation Formula

```
    ┌─────────────────────────────────────────────────────────────────┐
    │                                                                 │
    │   PE Operation (each clock cycle):                             │
    │   ═══════════════════════════════                              │
    │                                                                 │
    │   accumulator_next = accumulator + (weight × activation)       │
    │                      + partial_sum_in                          │
    │                                                                 │
    │   ┌─────────────────────────────────────────────────────────┐  │
    │   │                                                         │  │
    │   │   acc' = acc + (w × a) + psum_in                       │  │
    │   │                                                         │  │
    │   │   Where:                                                │  │
    │   │     acc  = current accumulator value (32-bit)          │  │
    │   │     w    = weight register (16-bit, stationary)        │  │
    │   │     a    = activation input (16-bit, streaming)        │  │
    │   │     psum = partial sum from left neighbor (32-bit)     │  │
    │   │                                                         │  │
    │   └─────────────────────────────────────────────────────────┘  │
    │                                                                 │
    └─────────────────────────────────────────────────────────────────┘
```

---

## 4. State Machine - Cube's Brain

### 4.1 FSM States Visualization

```
    ╔═══════════════════════════════════════════════════════════════════╗
    ║                        CUBE FSM STATES                            ║
    ╠═══════════════════════════════════════════════════════════════════╣
    ║                                                                   ║
    ║   ┌─────────────────────────────────────────────────────────┐    ║
    ║   │                                                         │    ║
    ║   │    ┌──────────┐                                        │    ║
    ║   │    │          │                                        │    ║
    ║   │    │   IDLE   │◄─────────────────────────────────┐     │    ║
    ║   │    │          │                                  │     │    ║
    ║   │    │  ○ ○ ○   │  Waiting for START signal       │     │    ║
    ║   │    └────┬─────┘                                  │     │    ║
    ║   │         │ START=1                                │     │    ║
    ║   │         ▼                                        │     │    ║
    ║   │    ┌──────────┐                                  │     │    ║
    ║   │    │   LOAD   │                                  │     │    ║
    ║   │    │ WEIGHTS  │  Loading 256 weights (1 cycle)  │     │    ║
    ║   │    │  ▓ ▓ ▓   │                                  │     │    ║
    ║   │    └────┬─────┘                                  │     │    ║
    ║   │         │                                        │     │    ║
    ║   │         ▼                                        │     │    ║
    ║   │    ┌──────────┐                                  │     │    ║
    ║   │    │ COMPUTE  │                                  │     │    ║
    ║   │    │          │  Streaming activations          │     │    ║
    ║   │    │  ▓▓▓▓▓▓  │  (16 cycles)                    │     │    ║
    ║   │    └────┬─────┘                                  │     │    ║
    ║   │         │                                        │     │    ║
    ║   │         ▼                                        │     │    ║
    ║   │    ┌──────────┐                                  │     │    ║
    ║   │    │  DRAIN   │                                  │     │    ║
    ║   │    │          │  Flushing pipeline              │     │    ║
    ║   │    │  ░░░░░░  │  (15 cycles)                    │     │    ║
    ║   │    └────┬─────┘                                  │     │    ║
    ║   │         │                                        │     │    ║
    ║   │         ▼                                        │     │    ║
    ║   │    ┌──────────┐                                  │     │    ║
    ║   │    │   DONE   │                                  │     │    ║
    ║   │    │          │  Results ready!                 │     │    ║
    ║   │    │  ✓ ✓ ✓   │                                  │     │    ║
    ║   │    └────┬─────┘                                  │     │    ║
    ║   │         │ RESET=1                                │     │    ║
    ║   │         └────────────────────────────────────────┘     │    ║
    ║   │                                                         │    ║
    ║   └─────────────────────────────────────────────────────────┘    ║
    ║                                                                   ║
    ╚═══════════════════════════════════════════════════════════════════╝
```

### 4.2 Timing Overview

```
    ┌─────────────────────────────────────────────────────────────────────┐
    │                         TIMING DIAGRAM                              │
    ├─────────────────────────────────────────────────────────────────────┤
    │                                                                     │
    │  Cycle:  0    1    2    3    ...   17   18   ...   31   32         │
    │          │    │    │    │          │    │          │    │          │
    │  State:  │IDLE│LOAD│────COMPUTE────│────DRAIN─────│DONE│          │
    │          │    │    │               │               │    │          │
    │          ├────┼────┼───────────────┼───────────────┼────┤          │
    │  busy:   │ 0  │ 1  │       1       │       1       │ 0  │          │
    │          ├────┼────┼───────────────┼───────────────┼────┤          │
    │  done:   │ 0  │ 0  │       0       │       0       │ 1  │          │
    │          └────┴────┴───────────────┴───────────────┴────┘          │
    │                                                                     │
    │  Total: 1 (load) + 16 (compute) + 15 (drain) = 32 cycles           │
    │                                                                     │
    └─────────────────────────────────────────────────────────────────────┘
```

---

## 5. Memory Map - How to Talk to Cube

### 5.1 Address Space

```
    ╔═══════════════════════════════════════════════════════════════════╗
    ║                      MEMORY MAP (Base: 0x80000000)                ║
    ╠═══════════════════════════════════════════════════════════════════╣
    ║                                                                   ║
    ║   Address Range              Content              Size            ║
    ║   ─────────────────────────────────────────────────────────────  ║
    ║                                                                   ║
    ║   0x80000000 ┌──────────────────────────┐                        ║
    ║              │      CONTROL Register    │  8 bytes               ║
    ║              │  [START] [RESET] [...]   │                        ║
    ║   0x80000008 ├──────────────────────────┤                        ║
    ║              │      STATUS Register     │  8 bytes               ║
    ║              │  [DONE] [BUSY] [...]     │                        ║
    ║   0x80000010 ├──────────────────────────┤                        ║
    ║              │                          │                        ║
    ║              │    Activation Buffer     │  512 bytes             ║
    ║              │    A[0] ... A[15]        │  (16 × 16-bit)         ║
    ║              │    (16-bit each)         │                        ║
    ║              │                          │                        ║
    ║   0x80000210 ├──────────────────────────┤                        ║
    ║              │                          │                        ║
    ║              │     Weight Buffer        │  512 bytes             ║
    ║              │    W[0][0]...W[15][15]   │  (256 × 16-bit)        ║
    ║              │    (16-bit each)         │                        ║
    ║              │                          │                        ║
    ║   0x80000410 ├──────────────────────────┤                        ║
    ║              │                          │                        ║
    ║              │     Result Buffer        │  1024 bytes            ║
    ║              │    C[0][0]...C[15][15]   │  (256 × 32-bit)        ║
    ║              │    (32-bit each)         │                        ║
    ║              │                          │                        ║
    ║   0x80000810 └──────────────────────────┘                        ║
    ║                                                                   ║
    ╚═══════════════════════════════════════════════════════════════════╝
```

### 5.2 Control Register Bits

```
    ┌─────────────────────────────────────────────────────────────────┐
    │                    CONTROL REGISTER (0x80000000)                │
    ├─────────────────────────────────────────────────────────────────┤
    │                                                                 │
    │   Bit 63                                              Bit 0    │
    │   ┌────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┐│
    │   │ .. │ .. │ .. │ .. │ .. │ .. │ .. │ .. │ .. │ .. │RST │STRT││
    │   └────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┘│
    │                                                      │    │    │
    │                                                      │    │    │
    │   Bit 1: RESET ──────────────────────────────────────┘    │    │
    │          Write 1 to reset accelerator                     │    │
    │                                                           │    │
    │   Bit 0: START ───────────────────────────────────────────┘    │
    │          Write 1 to start computation                          │
    │                                                                 │
    └─────────────────────────────────────────────────────────────────┘
```

---

## 6. Step-by-Step Example

### 6.1 Simple 2×2 Multiplication

```
    ╔═══════════════════════════════════════════════════════════════════╗
    ║                    EXAMPLE: 2×2 MULTIPLICATION                    ║
    ╠═══════════════════════════════════════════════════════════════════╣
    ║                                                                   ║
    ║   Input:                                                          ║
    ║   ──────                                                          ║
    ║                                                                   ║
    ║   Weight Matrix W:          Activation Vector A:                  ║
    ║   ┌─────┬─────┐             ┌─────┐                              ║
    ║   │  1  │  2  │             │  5  │                              ║
    ║   ├─────┼─────┤             ├─────┤                              ║
    ║   │  3  │  4  │             │  6  │                              ║
    ║   └─────┴─────┘             └─────┘                              ║
    ║                                                                   ║
    ║   Computation:                                                    ║
    ║   ────────────                                                    ║
    ║                                                                   ║
    ║   C[0][0] = W[0][0] × A[0] = 1 × 5 = 5                           ║
    ║   C[0][1] = W[0][1] × A[1] = 2 × 6 = 12                          ║
    ║   C[1][0] = W[1][0] × A[0] = 3 × 5 = 15                          ║
    ║   C[1][1] = W[1][1] × A[1] = 4 × 6 = 24                          ║
    ║                                                                   ║
    ║   Result Matrix C:                                                ║
    ║   ┌─────┬─────┐                                                  ║
    ║   │  5  │ 12  │                                                  ║
    ║   ├─────┼─────┤                                                  ║
    ║   │ 15  │ 24  │                                                  ║
    ║   └─────┴─────┘                                                  ║
    ║                                                                   ║
    ╚═══════════════════════════════════════════════════════════════════╝
```

### 6.2 Cycle-by-Cycle Execution

```
    ┌─────────────────────────────────────────────────────────────────────┐
    │                    CYCLE-BY-CYCLE EXECUTION                         │
    ├─────────────────────────────────────────────────────────────────────┤
    │                                                                     │
    │   CYCLE 0: IDLE → LOAD_WEIGHTS                                     │
    │   ─────────────────────────────                                    │
    │                                                                     │
    │        ┌─────┐    ┌─────┐                                          │
    │   1 ──►│ PE  │    │ PE  │◄── 2                                     │
    │        │ w=1 │    │ w=2 │                                          │
    │        └─────┘    └─────┘                                          │
    │        ┌─────┐    ┌─────┐                                          │
    │   3 ──►│ PE  │    │ PE  │◄── 4                                     │
    │        │ w=3 │    │ w=4 │                                          │
    │        └─────┘    └─────┘                                          │
    │                                                                     │
    │   CYCLE 1: COMPUTE (stream A[0]=5, A[1]=6)                         │
    │   ────────────────────────────────────────                         │
    │                                                                     │
    │          a=5       a=6                                             │
    │           ↓         ↓                                              │
    │        ┌─────┐    ┌─────┐                                          │
    │   0 ──►│1×5=5│───►│2×6  │───► 12                                   │
    │        │acc=5│    │=12  │                                          │
    │        └──┬──┘    └──┬──┘                                          │
    │           ↓          ↓                                             │
    │        ┌─────┐    ┌─────┐                                          │
    │   0 ──►│3×5  │───►│4×6  │───► 24                                   │
    │        │=15  │    │=24  │                                          │
    │        └──┬──┘    └──┬──┘                                          │
    │           ↓          ↓                                             │
    │         acc=15    acc=24                                           │
    │                                                                     │
    │   CYCLE 2+: DRAIN (results propagate)                              │
    │   ───────────────────────────────────                              │
    │                                                                     │
    │   Final Results:                                                   │
    │        C[0][0]=5   C[0][1]=12                                      │
    │        C[1][0]=15  C[1][1]=24                                      │
    │                                                                     │
    └─────────────────────────────────────────────────────────────────────┘
```

---

## 7. Weight-Stationary Dataflow Explained

### 7.1 Why "Weight-Stationary"?

```
    ╔═══════════════════════════════════════════════════════════════════╗
    ║                    WEIGHT-STATIONARY DATAFLOW                     ║
    ╠═══════════════════════════════════════════════════════════════════╣
    ║                                                                   ║
    ║   The key insight: Weights are loaded ONCE and stay in place     ║
    ║   while activations STREAM through the array.                    ║
    ║                                                                   ║
    ║   ┌─────────────────────────────────────────────────────────┐    ║
    ║   │                                                         │    ║
    ║   │   WEIGHTS (Stationary)      ACTIVATIONS (Streaming)    │    ║
    ║   │   ════════════════════      ═══════════════════════    │    ║
    ║   │                                                         │    ║
    ║   │   ┌───┐ ┌───┐ ┌───┐         a0 ──► a1 ──► a2 ──►      │    ║
    ║   │   │ w │ │ w │ │ w │              (flows through)       │    ║
    ║   │   │   │ │   │ │   │                                    │    ║
    ║   │   │ ● │ │ ● │ │ ● │         Each cycle, new            │    ║
    ║   │   │   │ │   │ │   │         activations enter          │    ║
    ║   │   └───┘ └───┘ └───┘                                    │    ║
    ║   │   (stay in place)                                      │    ║
    ║   │                                                         │    ║
    ║   └─────────────────────────────────────────────────────────┘    ║
    ║                                                                   ║
    ║   Benefits:                                                       ║
    ║   • Weights loaded once → less memory bandwidth                  ║
    ║   • Activations reused across all PEs in a column               ║
    ║   • Efficient for neural network inference                       ║
    ║                                                                   ║
    ╚═══════════════════════════════════════════════════════════════════╝
```

### 7.2 Data Reuse Pattern

```
    ┌─────────────────────────────────────────────────────────────────────┐
    │                      DATA REUSE VISUALIZATION                       │
    ├─────────────────────────────────────────────────────────────────────┤
    │                                                                     │
    │   Activation a[0] is used by ALL PEs in column 0:                  │
    │                                                                     │
    │                    a[0]                                             │
    │                     │                                               │
    │         ┌───────────┼───────────┐                                  │
    │         │           │           │                                  │
    │         ▼           ▼           ▼                                  │
    │      ┌─────┐     ┌─────┐     ┌─────┐                              │
    │      │PE00 │     │PE10 │     │PE20 │  ... (16 PEs use same a[0]) │
    │      │w00×a│     │w10×a│     │w20×a│                              │
    │      └─────┘     └─────┘     └─────┘                              │
    │                                                                     │
    │   Weight w[0][0] is used for ALL activations in that position:    │
    │                                                                     │
    │      Cycle 1: w00 × a[0]                                           │
    │      Cycle 2: w00 × a[0]  (next batch)                            │
    │      Cycle 3: w00 × a[0]  (next batch)                            │
    │      ...                                                           │
    │                                                                     │
    │   This reuse pattern minimizes data movement!                      │
    │                                                                     │
    └─────────────────────────────────────────────────────────────────────┘
```

---

## 8. 3D Visualization of the Cube

### 8.1 Isometric View

```
                              Activations (streaming down)
                                    │ │ │ │
                                    ▼ ▼ ▼ ▼
                               ┌─────────────┐
                              ╱             ╱│
                             ╱  ■ ■ ■ ■   ╱ │
                            ╱  ■ ■ ■ ■   ╱  │
                           ╱  ■ ■ ■ ■   ╱   │
                          ╱  ■ ■ ■ ■   ╱    │
                         ┌─────────────┐     │
                         │  ■ ■ ■ ■   │     │
        Weights ────────►│  ■ ■ ■ ■   │     │
        (loaded once)    │  ■ ■ ■ ■   │    ╱
                         │  ■ ■ ■ ■   │   ╱
                         │             │  ╱
                         └─────────────┘ ╱
                                │ │ │ │
                                ▼ ▼ ▼ ▼
                           Results (accumulated)
```

### 8.2 Layer-by-Layer View

```
    ╔═══════════════════════════════════════════════════════════════════╗
    ║                    CUBE LAYERS (16 rows)                          ║
    ╠═══════════════════════════════════════════════════════════════════╣
    ║                                                                   ║
    ║   Layer 0 (Row 0):    ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■           ║
    ║   Layer 1 (Row 1):    ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■           ║
    ║   Layer 2 (Row 2):    ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■           ║
    ║   Layer 3 (Row 3):    ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■           ║
    ║   Layer 4 (Row 4):    ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■           ║
    ║   Layer 5 (Row 5):    ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■           ║
    ║   Layer 6 (Row 6):    ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■           ║
    ║   Layer 7 (Row 7):    ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■           ║
    ║   Layer 8 (Row 8):    ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■           ║
    ║   Layer 9 (Row 9):    ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■           ║
    ║   Layer 10 (Row 10):  ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■           ║
    ║   Layer 11 (Row 11):  ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■           ║
    ║   Layer 12 (Row 12):  ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■           ║
    ║   Layer 13 (Row 13):  ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■           ║
    ║   Layer 14 (Row 14):  ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■           ║
    ║   Layer 15 (Row 15):  ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■           ║
    ║                                                                   ║
    ║   Total: 16 × 16 = 256 Processing Elements                       ║
    ║                                                                   ║
    ╚═══════════════════════════════════════════════════════════════════╝
```

---

## 9. Programming Interface

### 9.1 C/C++ Usage Example

```c
    ╔═══════════════════════════════════════════════════════════════════╗
    ║                    HOW TO USE CUBE (C/C++)                        ║
    ╠═══════════════════════════════════════════════════════════════════╣

    // Step 1: Define base address
    #define CUBE_BASE       0x80000000
    #define CUBE_CONTROL    (CUBE_BASE + 0x00)
    #define CUBE_STATUS     (CUBE_BASE + 0x08)
    #define CUBE_MATRIX_A   (CUBE_BASE + 0x10)
    #define CUBE_MATRIX_W   (CUBE_BASE + 0x210)
    #define CUBE_MATRIX_C   (CUBE_BASE + 0x410)

    // Step 2: Load weights (256 values, 16-bit each)
    for (int i = 0; i < 256; i++) {
        *(uint16_t*)(CUBE_MATRIX_W + i*2) = weights[i];
    }

    // Step 3: Load activations (16 values, 16-bit each)
    for (int i = 0; i < 16; i++) {
        *(uint16_t*)(CUBE_MATRIX_A + i*2) = activations[i];
    }

    // Step 4: Start computation
    *(uint64_t*)CUBE_CONTROL = 0x01;  // Set START bit

    // Step 5: Wait for completion
    while (!(*(uint64_t*)CUBE_STATUS & 0x01)) {
        // Poll DONE bit
    }

    // Step 6: Read results (256 values, 32-bit each)
    for (int i = 0; i < 256; i++) {
        results[i] = *(uint32_t*)(CUBE_MATRIX_C + i*4);
    }

    // Step 7: Reset for next operation
    *(uint64_t*)CUBE_CONTROL = 0x02;  // Set RESET bit

    ╚═══════════════════════════════════════════════════════════════════╝
```

### 9.2 Operation Sequence Diagram

```
    ┌─────────────────────────────────────────────────────────────────────┐
    │                    OPERATION SEQUENCE                               │
    ├─────────────────────────────────────────────────────────────────────┤
    │                                                                     │
    │   CPU                                    CUBE                       │
    │    │                                      │                         │
    │    │  ──── Write Weights ────────────►   │                         │
    │    │       (256 × 16-bit)                 │                         │
    │    │                                      │                         │
    │    │  ──── Write Activations ─────────►  │                         │
    │    │       (16 × 16-bit)                  │                         │
    │    │                                      │                         │
    │    │  ──── Write CONTROL=START ───────►  │                         │
    │    │                                      │                         │
    │    │                                      │ ┌─────────────────┐    │
    │    │                                      │ │ LOAD_WEIGHTS    │    │
    │    │                                      │ │ (1 cycle)       │    │
    │    │                                      │ └────────┬────────┘    │
    │    │                                      │          │             │
    │    │                                      │ ┌────────▼────────┐    │
    │    │                                      │ │ COMPUTE         │    │
    │    │                                      │ │ (16 cycles)     │    │
    │    │                                      │ └────────┬────────┘    │
    │    │                                      │          │             │
    │    │                                      │ ┌────────▼────────┐    │
    │    │                                      │ │ DRAIN           │    │
    │    │                                      │ │ (15 cycles)     │    │
    │    │                                      │ └────────┬────────┘    │
    │    │                                      │          │             │
    │    │  ◄──── STATUS=DONE ─────────────    │ ┌────────▼────────┐    │
    │    │                                      │ │ DONE            │    │
    │    │                                      │ └─────────────────┘    │
    │    │  ──── Read Results ──────────────►  │                         │
    │    │       (256 × 32-bit)                 │                         │
    │    │                                      │                         │
    │    │  ──── Write CONTROL=RESET ───────►  │                         │
    │    │                                      │                         │
    │    ▼                                      ▼                         │
    │                                                                     │
    └─────────────────────────────────────────────────────────────────────┘
```

---

## 10. Performance Characteristics

### 10.1 Throughput Analysis

```
    ╔═══════════════════════════════════════════════════════════════════╗
    ║                    PERFORMANCE METRICS                            ║
    ╠═══════════════════════════════════════════════════════════════════╣
    ║                                                                   ║
    ║   Array Size:           16 × 16 = 256 PEs                        ║
    ║   Operations per PE:    1 MAC (Multiply-Accumulate) per cycle    ║
    ║   Total MACs per cycle: 256 MACs                                 ║
    ║                                                                   ║
    ║   ┌─────────────────────────────────────────────────────────┐    ║
    ║   │                                                         │    ║
    ║   │   Cycle Breakdown:                                      │    ║
    ║   │   ─────────────────                                     │    ║
    ║   │                                                         │    ║
    ║   │   LOAD_WEIGHTS:  1 cycle   ████                        │    ║
    ║   │   COMPUTE:      16 cycles  ████████████████████████████│    ║
    ║   │   DRAIN:        15 cycles  ███████████████████████████ │    ║
    ║   │   ─────────────────────────────────────────────────────│    ║
    ║   │   TOTAL:        32 cycles                               │    ║
    ║   │                                                         │    ║
    ║   └─────────────────────────────────────────────────────────┘    ║
    ║                                                                   ║
    ║   Effective Throughput:                                          ║
    ║   ─────────────────────                                          ║
    ║   • 256 results in 32 cycles                                     ║
    ║   • = 8 results per cycle (average)                              ║
    ║   • At 100 MHz: 800 million results/second                       ║
    ║                                                                   ║
    ╚═══════════════════════════════════════════════════════════════════╝
```

### 10.2 Comparison with Sequential Execution

```
    ┌─────────────────────────────────────────────────────────────────────┐
    │                    SPEEDUP COMPARISON                               │
    ├─────────────────────────────────────────────────────────────────────┤
    │                                                                     │
    │   Sequential (CPU):                                                │
    │   ─────────────────                                                │
    │   for i in 0..16:                                                  │
    │     for j in 0..16:                                                │
    │       C[i][j] = W[i][j] * A[j]   // 256 iterations                │
    │                                                                     │
    │   Total: 256 cycles (1 MAC per cycle)                              │
    │                                                                     │
    │   ████████████████████████████████████████████████████████████████ │
    │   ████████████████████████████████████████████████████████████████ │
    │   ████████████████████████████████████████████████████████████████ │
    │   ████████████████████████████████████████████████████████████████ │
    │                                                                     │
    │   Cube (Parallel):                                                 │
    │   ────────────────                                                 │
    │   All 256 MACs computed in parallel                                │
    │                                                                     │
    │   Total: 32 cycles                                                 │
    │                                                                     │
    │   ████████████████████                                             │
    │                                                                     │
    │   ┌─────────────────────────────────────────────────────────────┐  │
    │   │                                                             │  │
    │   │   SPEEDUP = 256 / 32 = 8×                                  │  │
    │   │                                                             │  │
    │   └─────────────────────────────────────────────────────────────┘  │
    │                                                                     │
    └─────────────────────────────────────────────────────────────────────┘
```

---

## 11. Common Use Cases

### 11.1 Neural Network Inference

```
    ╔═══════════════════════════════════════════════════════════════════╗
    ║                    NEURAL NETWORK LAYER                           ║
    ╠═══════════════════════════════════════════════════════════════════╣
    ║                                                                   ║
    ║   Fully Connected Layer:                                         ║
    ║   ──────────────────────                                         ║
    ║                                                                   ║
    ║   Input (16 neurons)     Weights (16×16)      Output (16 neurons)║
    ║                                                                   ║
    ║   ┌───┐                 ┌─────────────┐       ┌───┐              ║
    ║   │ x │                 │ w w w w w w │       │ y │              ║
    ║   │ x │                 │ w w w w w w │       │ y │              ║
    ║   │ x │       ×         │ w w w w w w │   =   │ y │              ║
    ║   │ x │                 │ w w w w w w │       │ y │              ║
    ║   │ . │                 │ . . . . . . │       │ . │              ║
    ║   │ . │                 │ . . . . . . │       │ . │              ║
    ║   └───┘                 └─────────────┘       └───┘              ║
    ║                                                                   ║
    ║   y[i] = Σ w[i][j] × x[j]  (for j = 0..15)                      ║
    ║                                                                   ║
    ║   Perfect fit for Cube accelerator!                              ║
    ║                                                                   ║
    ╚═══════════════════════════════════════════════════════════════════╝
```

### 11.2 Image Processing

```
    ┌─────────────────────────────────────────────────────────────────────┐
    │                    IMAGE CONVOLUTION                                │
    ├─────────────────────────────────────────────────────────────────────┤
    │                                                                     │
    │   16×16 image patch processed in one Cube operation:               │
    │                                                                     │
    │   ┌─────────────────┐                                              │
    │   │ ░ ░ ░ ░ ░ ░ ░ ░ │                                              │
    │   │ ░ ░ ░ ░ ░ ░ ░ ░ │     Flatten to      ┌───┐                   │
    │   │ ░ ░ ░ ░ ░ ░ ░ ░ │     16-element  ──► │ a │                   │
    │   │ ░ ░ ░ ░ ░ ░ ░ ░ │     vector          │ a │                   │
    │   │ ░ ░ ░ ░ ░ ░ ░ ░ │                     │ . │                   │
    │   │ ░ ░ ░ ░ ░ ░ ░ ░ │                     │ . │                   │
    │   │ ░ ░ ░ ░ ░ ░ ░ ░ │                     └───┘                   │
    │   │ ░ ░ ░ ░ ░ ░ ░ ░ │                                              │
    │   └─────────────────┘                                              │
    │        Image Patch                                                 │
    │                                                                     │
    └─────────────────────────────────────────────────────────────────────┘
```

---

## 12. Quick Reference Card

```
╔═══════════════════════════════════════════════════════════════════════════╗
║                         CUBE QUICK REFERENCE                              ║
╠═══════════════════════════════════════════════════════════════════════════╣
║                                                                           ║
║  SPECIFICATIONS                    MEMORY MAP                             ║
║  ──────────────                    ──────────                             ║
║  Array Size:    16×16 (256 PEs)    Base:        0x80000000               ║
║  Weight Width:  16-bit             Control:     Base + 0x00              ║
║  Activation:    16-bit             Status:      Base + 0x08              ║
║  Result Width:  32-bit             Activations: Base + 0x10              ║
║  Total Cycles:  32                 Weights:     Base + 0x210             ║
║                                    Results:     Base + 0x410             ║
║                                                                           ║
║  CONTROL BITS                      STATUS BITS                            ║
║  ────────────                      ───────────                            ║
║  Bit 0: START                      Bit 0: DONE                            ║
║  Bit 1: RESET                      Bit 1: BUSY                            ║
║                                                                           ║
║  FSM STATES                        TIMING                                 ║
║  ──────────                        ──────                                 ║
║  0: IDLE                           LOAD:    1 cycle                       ║
║  1: LOAD_WEIGHTS                   COMPUTE: 16 cycles                     ║
║  2: COMPUTE                        DRAIN:   15 cycles                     ║
║  3: DRAIN                          TOTAL:   32 cycles                     ║
║  4: DONE                                                                  ║
║                                                                           ║
║  OPERATION SEQUENCE                                                       ║
║  ──────────────────                                                       ║
║  1. Write weights to 0x210-0x40F                                         ║
║  2. Write activations to 0x10-0x2F                                       ║
║  3. Write 0x01 to Control (START)                                        ║
║  4. Poll Status until DONE=1                                             ║
║  5. Read results from 0x410-0x80F                                        ║
║  6. Write 0x02 to Control (RESET)                                        ║
║                                                                           ║
╚═══════════════════════════════════════════════════════════════════════════╝
```

---

## Related Documentation

- [ARCHITECTURE.md](ARCHITECTURE.md) - Detailed technical architecture
- [README.md](README.md) - Getting started guide
- [IMPROVEMENT_PLAN.md](IMPROVEMENT_PLAN.md) - Future development roadmap
