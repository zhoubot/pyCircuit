// Generated by pyCircuit examples/update_generated.sh
// Top wrapper: EXAM2021_TOP
//
// This wrapper hides FEIN/FEOUT ports by instantiating Forwarding Engines (FE)
// internally and exposing only the exam-style PKTIN/PKTOUT/BKPR interface.
//
// Files required to simulate/synthesize this example:
// - fastfwd_pyc/fastfwd_pyc.v          (FastFwd core netlist)
// - fastfwd_pyc/fe.v                  (FE model stub; replace with official exam FE RTL)
// - include/pyc/verilog/*.v             (pyCircuit Verilog primitives, used via Verilog include directives in fastfwd_pyc.v)
//
module EXAM2021_TOP(
  input clk,
  input rst_n,
  input lane0_pkt_in_vld,
  input lane1_pkt_in_vld,
  input lane2_pkt_in_vld,
  input lane3_pkt_in_vld,
  input [127:0] lane0_pkt_in_data,
  input [127:0] lane1_pkt_in_data,
  input [127:0] lane2_pkt_in_data,
  input [127:0] lane3_pkt_in_data,
  input [4:0] lane0_pkt_in_ctrl,
  input [4:0] lane1_pkt_in_ctrl,
  input [4:0] lane2_pkt_in_ctrl,
  input [4:0] lane3_pkt_in_ctrl,
  output lane0_pkt_out_vld,
  output lane1_pkt_out_vld,
  output lane2_pkt_out_vld,
  output lane3_pkt_out_vld,
  output [127:0] lane0_pkt_out_data,
  output [127:0] lane1_pkt_out_data,
  output [127:0] lane2_pkt_out_data,
  output [127:0] lane3_pkt_out_data,
  output reg pkt_in_bkpr
);
  localparam integer N_FE = 4;

  wire rst;
  assign rst = ~rst_n;

  // Internal FE buses.
  wire [N_FE-1:0]       fwd_pkt_data_vld;
  wire [N_FE*128-1:0]   fwd_pkt_data;
  wire [N_FE*2-1:0]     fwd_pkt_lat;
  wire [N_FE-1:0]       fwd_pkt_dp_vld;
  wire [N_FE*128-1:0]   fwd_pkt_dp_data;
  wire [N_FE-1:0]       fwded_pkt_data_vld;
  wire [N_FE*128-1:0]   fwded_pkt_data;

  wire pkt_in_bkpr_w;

  // FastFwd core (generated from pyCircuit).
  FastFwd U_CORE (
    .clk(clk),
    .rst(rst),
    .lane0_pkt_in_vld(lane0_pkt_in_vld),
    .lane1_pkt_in_vld(lane1_pkt_in_vld),
    .lane2_pkt_in_vld(lane2_pkt_in_vld),
    .lane3_pkt_in_vld(lane3_pkt_in_vld),
    .lane0_pkt_in_data(lane0_pkt_in_data),
    .lane1_pkt_in_data(lane1_pkt_in_data),
    .lane2_pkt_in_data(lane2_pkt_in_data),
    .lane3_pkt_in_data(lane3_pkt_in_data),
    .lane0_pkt_in_ctrl(lane0_pkt_in_ctrl),
    .lane1_pkt_in_ctrl(lane1_pkt_in_ctrl),
    .lane2_pkt_in_ctrl(lane2_pkt_in_ctrl),
    .lane3_pkt_in_ctrl(lane3_pkt_in_ctrl),
    .fwded0_pkt_data_vld(fwded_pkt_data_vld[0]),
    .fwded0_pkt_data(fwded_pkt_data[0*128+127:0*128]),
    .fwded1_pkt_data_vld(fwded_pkt_data_vld[1]),
    .fwded1_pkt_data(fwded_pkt_data[1*128+127:1*128]),
    .fwded2_pkt_data_vld(fwded_pkt_data_vld[2]),
    .fwded2_pkt_data(fwded_pkt_data[2*128+127:2*128]),
    .fwded3_pkt_data_vld(fwded_pkt_data_vld[3]),
    .fwded3_pkt_data(fwded_pkt_data[3*128+127:3*128]),
    .pkt_in_bkpr(pkt_in_bkpr_w),
    .lane0_pkt_out_vld(lane0_pkt_out_vld),
    .lane0_pkt_out_data(lane0_pkt_out_data),
    .lane1_pkt_out_vld(lane1_pkt_out_vld),
    .lane1_pkt_out_data(lane1_pkt_out_data),
    .lane2_pkt_out_vld(lane2_pkt_out_vld),
    .lane2_pkt_out_data(lane2_pkt_out_data),
    .lane3_pkt_out_vld(lane3_pkt_out_vld),
    .lane3_pkt_out_data(lane3_pkt_out_data),
    .fwd0_pkt_data_vld(fwd_pkt_data_vld[0]),
    .fwd0_pkt_data(fwd_pkt_data[0*128+127:0*128]),
    .fwd0_pkt_lat(fwd_pkt_lat[0*2+1:0*2]),
    .fwd0_pkt_dp_vld(fwd_pkt_dp_vld[0]),
    .fwd0_pkt_dp_data(fwd_pkt_dp_data[0*128+127:0*128]),
    .fwd1_pkt_data_vld(fwd_pkt_data_vld[1]),
    .fwd1_pkt_data(fwd_pkt_data[1*128+127:1*128]),
    .fwd1_pkt_lat(fwd_pkt_lat[1*2+1:1*2]),
    .fwd1_pkt_dp_vld(fwd_pkt_dp_vld[1]),
    .fwd1_pkt_dp_data(fwd_pkt_dp_data[1*128+127:1*128]),
    .fwd2_pkt_data_vld(fwd_pkt_data_vld[2]),
    .fwd2_pkt_data(fwd_pkt_data[2*128+127:2*128]),
    .fwd2_pkt_lat(fwd_pkt_lat[2*2+1:2*2]),
    .fwd2_pkt_dp_vld(fwd_pkt_dp_vld[2]),
    .fwd2_pkt_dp_data(fwd_pkt_dp_data[2*128+127:2*128]),
    .fwd3_pkt_data_vld(fwd_pkt_data_vld[3]),
    .fwd3_pkt_data(fwd_pkt_data[3*128+127:3*128]),
    .fwd3_pkt_lat(fwd_pkt_lat[3*2+1:3*2]),
    .fwd3_pkt_dp_vld(fwd_pkt_dp_vld[3]),
    .fwd3_pkt_dp_data(fwd_pkt_dp_data[3*128+127:3*128])
  );

  // Keep the exam-style BKPR port type (output reg).
  always @(*) begin
    pkt_in_bkpr = pkt_in_bkpr_w;
  end

  // Instantiate Forwarding Engines internally.
  genvar i;
  generate
    for (i = 0; i < N_FE; i = i + 1) begin: FE
      FE U_FE (
        .clk(clk),
        .rst_n(rst_n),
        .fwd_pkt_data_vld(fwd_pkt_data_vld[i]),
        .fwd_pkt_data(fwd_pkt_data[i*128+127:i*128]),
        .fwd_pkt_lat(fwd_pkt_lat[i*2+1:i*2]),
        .fwd_pkt_dp_vld(fwd_pkt_dp_vld[i]),
        .fwd_pkt_dp_data(fwd_pkt_dp_data[i*128+127:i*128]),
        .fwded_pkt_data_vld(fwded_pkt_data_vld[i]),
        .fwded_pkt_data(fwded_pkt_data[i*128+127:i*128])
      );
    end
  endgenerate
endmodule
